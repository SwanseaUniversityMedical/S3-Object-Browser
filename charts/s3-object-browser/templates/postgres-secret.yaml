apiVersion: v1
kind: Secret
metadata:
  name: postgres-secret
  namespace: {{ .Release.Namespace }}
type: Opaque
stringData:
  password: {{ .Values.postgres.auth.password | quote }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-init-script
  namespace: {{ .Release.Namespace }}
data:
  01-audit.sql: |
    -- Create audit_logs database and schema
    CREATE DATABASE audit_logs;
    \c audit_logs;
    
    CREATE TABLE IF NOT EXISTS audit_log (
        id SERIAL PRIMARY KEY,
        timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        user_id VARCHAR(255),
        action VARCHAR(255),
        resource VARCHAR(255),
        status VARCHAR(50),
        details JSONB,
        ip_address VARCHAR(45),
        user_agent TEXT
    );
    
    CREATE INDEX idx_audit_timestamp ON audit_log(timestamp);
    CREATE INDEX idx_audit_user_id ON audit_log(user_id);
    CREATE INDEX idx_audit_action ON audit_log(action);
